let db; const request = indexedDB.open("budget", 1); request.onupgradeneeded = function (c) { const a = c.target.result; a.createObjectStore("pending", { autoIncrement: !0 }) }, request.onsuccess = function (b) { db = b.target.result, navigator.onLine && checkDatabase() }, request.onerror = function (b) { console.log("Error! " + b.target.errorCode) }; function saveRecord(d) { const a = db.transaction(["pending"], "readwrite"), b = a.objectStore("pending"); b.add(d) } function checkDatabase() { const d = db.transaction(["pending"], "readwrite"), a = d.objectStore("pending"), b = a.getAll(); b.onsuccess = function () { 0 < b.result.length && fetch("/api/transaction/bulk", { method: "POST", body: JSON.stringify(b.result), headers: { Accept: "application/json, text/plain, */*", "Content-Type": "application/json" } }).then(b => b.json()).then(() => { const c = db.transaction(["pending"], "readwrite"), a = c.objectStore("pending"); a.clear() }) } } window.addEventListener("online", checkDatabase);